# Custom values for Azure deployment
# This file uses environment variables from .env.azure
# Variables are substituted by the deployment script
#
# DO NOT EDIT VERSION NUMBERS HERE - Change OPIK_VERSION in .env.azure instead
# This is a TEMPLATE file processed by deploy-opik-helm-azure.sh

registry: &registry $ACR_LOGIN_SERVER

component:
  backend:
    image:
      repository: opik-backend
      tag: $OPIK_VERSION
    env:
      OPIK_VERSION: "$OPIK_VERSION"
      TOGGLE_TRACE_THREAD_PYTHON_EVALUATOR_ENABLED: "true"
      OPIK_USAGE_REPORT_ENABLED: "true"
    ingress:
      enabled: true
      ingressClassName: "azure-application-gateway"
      annotations:
        appgw.ingress.kubernetes.io/ssl-redirect: "false"
        appgw.ingress.kubernetes.io/use-private-ip: "false"
        appgw.ingress.kubernetes.io/backend-protocol: "http"
        appgw.ingress.kubernetes.io/health-probe-path: "/health-check"
      hosts:
        - paths:
            - path: /v1
              port: 8080
              pathType: Prefix
            - path: /health-check
              port: 8080
              pathType: Prefix
      tls:
        enabled: false
      
  python-backend:
    image:
      repository: opik-python-backend
      tag: $OPIK_VERSION
    env:
      OPIK_VERSION: "$OPIK_VERSION"
      PYTHON_CODE_EXECUTOR_IMAGE_REGISTRY: *registry
      PYTHON_CODE_EXECUTOR_IMAGE_NAME: "opik-sandbox-executor-python"
      PYTHON_CODE_EXECUTOR_IMAGE_TAG: "$OPIK_VERSION"
      PYTHON_CODE_EXECUTOR_STRATEGY: "process"
      PYTHON_CODE_EXECUTOR_PARALLEL_NUM: "4"
      OPIK_REVERSE_PROXY_URL: ""
    ingress:
      enabled: true
      ingressClassName: "azure-application-gateway"
      annotations:
        appgw.ingress.kubernetes.io/ssl-redirect: "false"
        appgw.ingress.kubernetes.io/use-private-ip: "false"
        appgw.ingress.kubernetes.io/backend-protocol: "http"
        appgw.ingress.kubernetes.io/health-probe-path: "/healthcheck"
      hosts:
        - paths:
            - path: /v1/private/evaluators
              port: 8000
              pathType: Prefix
      tls:
        enabled: false
      
  frontend:
    image:
      repository: opik-frontend
      tag: $OPIK_VERSION
    ingress:
      enabled: true
      ingressClassName: "azure-application-gateway"
      annotations:
        appgw.ingress.kubernetes.io/ssl-redirect: "false"
        appgw.ingress.kubernetes.io/use-private-ip: "false"
        appgw.ingress.kubernetes.io/backend-protocol: "http"
      hosts:
        - paths:
            - path: /
              port: 5173
              pathType: Prefix
      tls:
        enabled: false

# Disable demo data generation for production
demoDataJob:
  enabled: false

# Configure resources for Azure
clickhouse:
  enabled: true
  persistence:
    enabled: true
    size: 20Gi
    
mysql:
  enabled: true
  primary:
    persistence:
      enabled: true
      size: 10Gi

redis:
  enabled: true
  master:
    persistence:
      enabled: true
      size: 5Gi
